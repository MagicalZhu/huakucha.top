---
  author: '花裤衩'
  title: 负载均衡算法
  tags:
    - 算法
    - 分布式
  date: 2022-12-27 08:06:44
  categories: 算法
  draft: false
---

[[TOC]]

# 常见的负载均衡算法

常见的负载均衡算法有下面几种:

1. 轮询法(Round Robin)
2. 加权轮询法(Weight Round Robin)
3. 平滑加权轮询法(Smooth Weight Round Robin)
4. 随机法(Random)
5. 加权随机法(Weight Random)
6. 源地址哈希法(Hash)
7. 最小连接数法(Least Connection)

## Round Robin

将请求按顺序轮流地分配到后端服务器上,它均衡地对待后端的每一台服务器,而不关心服务器实际的连接数和当前的系统负载


## Weight Round Robin

不同的后端服务器可能机器的配置和当前系统的负载并不相同,因此它们的抗压能力也不相同。

给配置高、负载低的机器配置更高的权重,让其处理更多的请；而配置低、负载高的机器,给其分配较低的权重,降低其系统负载,加权轮询能很好地处理这一问题,并将请求顺序且按照权重分配到后端

## Random

通过系统的随机算法,根据后端服务器的列表大小值来随机选取其中的一台服务器进行访问。

由概率统计理论可以得知,随着客户端调用服务端的次数增多,其实际效果越来越接近于平均分配调用量到后端的每一台服务器,也就是轮询的结果。

## Weight Random

与加权轮询法一样,加权随机法也根据后端机器的配置,系统的负载分配不同的权重。不同的是,它是按照权重随机请求后端服务器,而非顺序

## Hash

源地址哈希的思想是根据获取客户端的IP地址,通过哈希函数计算得到的一个数值,用该数值对服务器列表的大小进行取模运算,得到的结果便是客服端要访问服务器的序号。

采用源地址哈希法进行负载均衡,同一IP地址的客户端,当后端服务器列表不变时,它每次都会映射到同一台后端服务器进行访问

## Least Connections

最小连接数算法比较灵活和智能,由于后端服务器的配置不尽相同,对于请求的处理有快有慢,它是根据后端服务器当前的连接情况,动态地选取其中当前积压连接数最少的一台服务器来处理当前的请求,尽可能地提高后端服务的利用效率,将负责合理地分流到每一台服务器

# Nginx的5种负载均衡算法

## Round Robin(Default)

每个请求按时间顺序逐一分配到不同的后端服务器,如果后端服务器down掉,能自动剔除

## Weight Round Robin (weight)

指定轮询几率,weight和访问比率成正比,用于后端服务器性能不均的情况

比如下面的配置:

```nginx
upstream bakend {
  server 192.168.0.14 weight=10;
  server 192.168.0.15 weight=10;
}
```

## Hash (ip_hash)

每个请求按访问ip的hash结果分配,这样每个访客固定访问一个后端服务器,可以解决session的问题

比如下面的配置:

```nginx
upstream bakend {
  ip_hash;
  server 192.168.0.14:88;
  server 192.168.0.15:80;
}
```

